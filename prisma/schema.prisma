// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Enums
enum DiscountType {
  PERCENTAGE
  FIXED_AMOUNT
}

enum BookingStatus {
  PENDING
  CONFIRMED
  CANCELLED
  COMPLETED
}

enum AdditionalServiceType {
  STANDARD
  BY_THREE
}

enum PaymentStatus {
  PENDING
  COMPLETED
  FAILED
  REFUNDED
}

enum OrderStatus {
  PENDING
  CONFIRMED
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

// Models
model Studio {
  id          String   @id @default(cuid())
  name        String
  location    String   @default("Dubai")
  imageUrl    String?
  totalSeats  Int
  openingTime String   // HH:MM format
  closingTime String   // HH:MM format
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  bookings Booking[]

  @@map("studios")
}

model ServiceType {
  id          String   @id @default(cuid())
  name        String   @unique
  description String?
  slug        String   @unique  
  sortOrder   Int      @default(0) 
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  services Service[]
  samples  Sample[]

  @@map("service_types")
}

model Service {
  id            String   @id @default(cuid())
  name          String   @unique
  description   String?
  includes      String[] @default([])
  imageUrl      String?
  serviceTypeId String
  isPopular     Boolean  @default(false)
  isActive      Boolean  @default(true)
  price         Decimal  @db.Decimal(10, 2)
  currency      String   @default("AED")
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Relations
  serviceType                   ServiceType                     @relation(fields: [serviceTypeId], references: [id])
  bookings                      Booking[]
  servicePackageRecords         ServicePackageRecord[]

  @@map("services")
}

model ServicePackageRecord {
  id                       String @id @default(cuid())
  parentContentPackageId   String
  includedServiceId        String
  serviceQuantity          Int

  // Relations
  package         Package @relation(fields: [parentContentPackageId], references: [id], onDelete: Cascade)
  includedService Service @relation(fields: [includedServiceId], references: [id], onDelete: Cascade)

  @@unique([parentContentPackageId, includedServiceId])
  @@map("service_packages_records")
}

model AddServicePackageRecord {
  id                       String @id @default(cuid())
  parentContentPackageId   String
  includedServiceId        String
  serviceQuantity          Int

  // Relations
  package                  Package           @relation(fields: [parentContentPackageId], references: [id], onDelete: Cascade)
  includedAdditionalService AdditionalService @relation(fields: [includedServiceId], references: [id], onDelete: Cascade)

  @@unique([parentContentPackageId, includedServiceId])
  @@map("add_service_packages_records")
}

model Package {
  id          String   @id @default(cuid())
  name        String
  description String?
  basePrice   Decimal  @db.Decimal(10, 2)
  currency    String   @default("AED")
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  bookings                     Booking[]
  servicePackageRecords        ServicePackageRecord[]
  addServicePackageRecords     AddServicePackageRecord[]

  @@map("packages")
}

model DiscountCode {
  id                     String       @id @default(cuid())
  code                   String       @unique
  type                   DiscountType
  value                  Decimal      @db.Decimal(10, 2)
  currency               String       @default("AED")
  isActive               Boolean      @default(true)
  startDate              DateTime     @default(now())
  endDate                DateTime
  usageLimit             Int?
  usedCount              Int          @default(0)
  firstTimeOnly          Boolean      @default(false)
  minOrderAmount         Decimal?     @db.Decimal(10, 2)
  applicableContentTypes String[]     // array of content type ids or names
  createdAt              DateTime     @default(now())
  updatedAt              DateTime     @updatedAt

  // Relations
  bookings Booking[]
  orders   Order[]

  @@map("discount_codes")
}

model Booking {
  id               String         @id @default(cuid())
  startTime        DateTime
  endTime          DateTime
  numberOfSeats    Int
  totalCost        Decimal        @db.Decimal(10, 2)
  vatAmount        Decimal?       @db.Decimal(10, 2)
  discountAmount   Decimal?       @db.Decimal(10, 2)
  finalAmount      Decimal?       @db.Decimal(10, 2)
  status           BookingStatus  @default(PENDING)
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt
  studioId         String?
  contentPackageId String?
  serviceId        String?
  leadId           String
  discountCodeId   String?

  // Relations
  studio                      Studio?                       @relation(fields: [studioId], references: [id])
  contentPackage              Package?                      @relation(fields: [contentPackageId], references: [id])
  service                     Service?                      @relation(fields: [serviceId], references: [id])
  lead                        Lead                          @relation(fields: [leadId], references: [id])
  discountCode                DiscountCode?                 @relation(fields: [discountCodeId], references: [id])
  bookingAdditionalServices   BookingAdditionalService[]
  payment                     Payment?

  @@map("bookings")
}

model Lead {
  id                String   @id @default(cuid())
  fullName          String
  email             String?
  phoneNumber       String?
  whatsappNumber    String?
  recordingLocation String?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  // Relations
  bookings Booking[]
  orders   Order[]

  @@map("leads")
}

model AdditionalService {
  id          String                  @id @default(cuid())
  name        String
  type        AdditionalServiceType   @default(STANDARD)
  price       Decimal                 @db.Decimal(10, 2)
  currency    String                  @default("AED")
  count       Int                     @default(1)
  description String?
  imageUrls   String[]
  isActive    Boolean                 @default(true)
  createdAt   DateTime                @default(now())
  updatedAt   DateTime                @updatedAt

  // Relations
  bookingAdditionalServices    BookingAdditionalService[]
  addServicePackageRecords     AddServicePackageRecord[]

  @@map("additional_services")
}

model BookingAdditionalService {
  id         String   @id @default(cuid())
  bookingId  String
  serviceId  String
  quantity   Int      @default(1)
  unitPrice  Decimal  @db.Decimal(10, 2)
  totalPrice Decimal  @db.Decimal(10, 2)
  createdAt  DateTime?
  updatedAt  DateTime?

  // Relations
  booking Booking           @relation(fields: [bookingId], references: [id], onDelete: Cascade)
  service AdditionalService @relation(fields: [serviceId], references: [id])

  @@unique([bookingId, serviceId])
  @@map("booking_additional_services")
}

model Payment {
  id            String        @id @default(cuid())
  bookingId     String        @unique
  amount        Decimal       @db.Decimal(10, 2)
  currency      String        @default("AED")
  status        PaymentStatus @default(PENDING)
  provider      String        @default("MAMO_PAY")
  externalId    String?
  paymentLinkId String?
  metadata      Json?
  completedAt   DateTime?
  refundedAt    DateTime?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt

  // Relations
  booking Booking @relation(fields: [bookingId], references: [id], onDelete: Cascade)

  @@map("payments")
}

model CaseStudy {
  id        String   @id @default(cuid())
  clientId  String?
  title     String?
  tagline   String?
  mainText  String?
  isActive  Boolean  @default(true)
  imageUrls String[]

  // Relations
  client      Client?           @relation(fields: [clientId], references: [id])
  staff       Staff[]           // Direct many-to-many relation
  equipment   Equipment[]       // Direct many-to-many relation
  caseContent CaseStudyContent[]

  @@map("case_studies")
}

model CaseStudyContent {
  id          String   @id @default(cuid())
  caseStudyId String
  title       String   
  text        String[] 
  list        String[] 
  imageUrl    String
  order       Int      
  
  // Relations
  caseStudy CaseStudy @relation(fields: [caseStudyId], references: [id], onDelete: Cascade)

  @@map("case_study_content")
}

model Equipment {
  id          String  @id @default(cuid())
  name        String?
  description String?
  imageUrl    String?

  // Relations
  caseStudies CaseStudy[] // Direct many-to-many relation

  @@map("equipment")
}

model Staff {
  id       String  @id @default(cuid())
  name     String?
  role     String?
  imageUrl String?

  // Relations
  caseStudies CaseStudy[] // Direct many-to-many relation

  @@map("staff")
}

model Client {
  id          String  @id @default(cuid())
  name        String?
  showTitle   String?
  jobTitle    String?
  testimonial String?
  featured    Boolean  @default(false)
  imageUrl    String?

  // Relations
  caseStudies CaseStudy[]

  @@map("clients")
}

model Sample {
  id            String  @id @default(cuid())
  name          String?
  thumbUrl      String?
  videoUrl      String?
  serviceTypeId String?

  // Relations
  serviceType ServiceType? @relation(fields: [serviceTypeId], references: [id])

  @@map("samples")
}

model BlogRecord {
  id        String   @id @default(cuid())
  title     String
  tagline   String
  mainText  String
  mainImageUrl String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("blog_records")
}

model Order {
  id               String       @id @default(cuid())
  serviceName      String       
  description      String?      
  requirements     String?      
  totalCost        Decimal      @db.Decimal(10, 2)
  vatAmount        Decimal?     @db.Decimal(10, 2)
  discountAmount   Decimal?     @db.Decimal(10, 2)
  finalAmount      Decimal?     @db.Decimal(10, 2)
  status           OrderStatus  @default(PENDING)
  estimatedDays    Int?         
  deadline         DateTime?    
  completedAt      DateTime?    
  createdAt        DateTime     @default(now())
  updatedAt        DateTime     @updatedAt
  leadId           String       
  discountCodeId   String?      
  
  // Relations
  lead        Lead          @relation(fields: [leadId], references: [id])
  discountCode DiscountCode? @relation(fields: [discountCodeId], references: [id])
  payment     OrderPayment?

  @@map("orders")
}

model OrderPayment {
  id            String        @id @default(cuid())
  orderId       String        @unique
  amount        Decimal       @db.Decimal(10, 2)
  currency      String        @default("AED")
  status        PaymentStatus @default(PENDING)
  provider      String        @default("MAMO_PAY")
  externalId    String?
  paymentLinkId String?
  metadata      Json?
  completedAt   DateTime?
  refundedAt    DateTime?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt

  // Relations
  order Order @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@map("order_payments")
}