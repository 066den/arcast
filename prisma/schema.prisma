// Prisma schema
// Learn more: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Studio {
  id              String           @id @default(cuid())
  name            String
  location        String           @default("Dubai")
  imageUrl        String?
  totalSeats      Int
  openingTime     String // HH:MM format
  closingTime     String // HH:MM format
  isActive        Boolean          @default(true)
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  bookings        Booking[]
  packages        StudioPackage[]
  contentPackages ContentPackage[]

  @@map("studios")
}

model ContentType {
  id          String           @id @default(cuid())
  name        String           @unique // "Reels", "Shorts", "Podcasts", "Long-form"
  description String?
  category    String // "SHORT_CONTENT" or "LONG_CONTENT"
  isActive    Boolean          @default(true)
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt
  packages    ContentPackage[]
  bookings    Booking[]

  @@map("content_types")
}

model ContentPackage {
  id                 String               @id @default(cuid())
  name               String
  description        String?
  contentTypeId      String
  serviceType        String // "PRODUCTION_ONLY", "FULL_SERVICE", "SCRIPT_DEVELOPMENT"
  basePrice          Decimal              @db.Decimal(10, 2)
  currency           String               @default("AED")
  includesPublishing Boolean              @default(false)
  publishingPrice    Decimal?             @db.Decimal(10, 2) // Additional cost for publishing
  isActive           Boolean              @default(true)
  createdAt          DateTime             @default(now())
  updatedAt          DateTime             @updatedAt
  contentType        ContentType          @relation(fields: [contentTypeId], references: [id])
  packagePerks       ContentPackagePerk[]
  bookings           Booking[]
  studios            Studio[]

  @@map("content_packages")
}

model StudioPackage {
  id             String        @id @default(uuid())
  name           String
  price_per_hour Decimal       @db.Decimal(10, 2)
  currency       String        @default("AED")
  description    String
  delivery_time  Int? // hours
  isActive       Boolean       @default(true)
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  studios        Studio[]
  packagePerks   PackagePerk[]
  bookings       Booking[]

  @@map("studio_packages")
}

model PackagePerk {
  id        String        @id @default(uuid())
  packageId String
  name      String
  count     Int? // Optional count for items like "3x Sony cameras"
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt
  package   StudioPackage @relation(fields: [packageId], references: [id], onDelete: Cascade)

  @@map("package_perks")
}

model ContentPackagePerk {
  id               String         @id @default(uuid())
  contentPackageId String
  name             String
  count            Int? // Optional count for items
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt
  contentPackage   ContentPackage @relation(fields: [contentPackageId], references: [id], onDelete: Cascade)

  @@map("content_package_perks")
}

model DiscountCode {
  id                     String       @id @default(cuid())
  code                   String       @unique
  type                   DiscountType
  value                  Decimal      @db.Decimal(10, 2)
  currency               String       @default("AED")
  isActive               Boolean      @default(true)
  startDate              DateTime     @default(now())
  endDate                DateTime
  usageLimit             Int? // Max number of uses
  usedCount              Int          @default(0)
  firstTimeOnly          Boolean      @default(false)
  minOrderAmount         Decimal?     @db.Decimal(10, 2)
  applicableContentTypes String[] // Which content types this applies to
  createdAt              DateTime     @default(now())
  updatedAt              DateTime     @updatedAt
  bookings               Booking[]

  @@map("discount_codes")
}

enum DiscountType {
  PERCENTAGE
  FIXED_AMOUNT
}

model Booking {
  id                 String                     @id @default(uuid())
  startTime          DateTime
  endTime            DateTime
  numberOfSeats      Int
  totalCost          Decimal                    @db.Decimal(10, 2)
  vatAmount          Decimal?                   @db.Decimal(10, 2)
  discountAmount     Decimal?                   @db.Decimal(10, 2)
  finalAmount        Decimal?                   @db.Decimal(10, 2)
  status             BookingStatus              @default(PENDING)
  createdAt          DateTime                   @default(now())
  updatedAt          DateTime                   @updatedAt
  studioId           String?
  packageId          String?
  contentPackageId   String?
  contentTypeId      String?
  leadId             String
  discountCodeId     String?
  studio             Studio?                    @relation(fields: [studioId], references: [id])
  package            StudioPackage?             @relation(fields: [packageId], references: [id])
  contentPackage     ContentPackage?            @relation(fields: [contentPackageId], references: [id])
  contentType        ContentType?               @relation(fields: [contentTypeId], references: [id])
  lead               Lead                       @relation(fields: [leadId], references: [id])
  discountCode       DiscountCode?              @relation(fields: [discountCodeId], references: [id])
  additionalServices BookingAdditionalService[]
  payment            Payment?

  @@map("bookings")
}

model Lead {
  id                String    @id @default(uuid())
  fullName          String
  email             String? // Made optional
  phoneNumber       String? // Made optional
  whatsappNumber    String? // Optional WhatsApp number
  recordingLocation String?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  bookings          Booking[]

  @@map("leads")
}

enum BookingStatus {
  PENDING
  CONFIRMED
  CANCELLED
  COMPLETED
}

enum AdditionalServiceType {
  STANDARD
  BY_THREE
}

model AdditionalService {
  id          String                     @id @default(uuid())
  name        String
  type        AdditionalServiceType      @default(STANDARD)
  price       Decimal                    @db.Decimal(10, 2)
  currency    String                     @default("AED")
  count       Int                        @default(1)
  description String?
  imageUrls   String[]
  isActive    Boolean                    @default(true)
  createdAt   DateTime                   @default(now())
  updatedAt   DateTime                   @updatedAt
  bookings    BookingAdditionalService[]

  @@map("additional_services")
}

model BookingAdditionalService {
  id                String            @id @default(cuid())
  bookingId         String
  serviceId         String
  quantity          Int               @default(1)
  unitPrice         Decimal           @db.Decimal(10, 2)
  totalPrice        Decimal           @db.Decimal(10, 2)
  booking           Booking           @relation(fields: [bookingId], references: [id], onDelete: Cascade)
  additionalService AdditionalService @relation(fields: [serviceId], references: [id])

  @@unique([bookingId, serviceId])
  @@map("booking_additional_services")
}

enum PaymentStatus {
  PENDING
  COMPLETED
  FAILED
  REFUNDED
}

model Payment {
  id            String        @id @default(uuid())
  bookingId     String        @unique
  amount        Decimal       @db.Decimal(10, 2)
  currency      String        @default("AED")
  status        PaymentStatus @default(PENDING)
  provider      String        @default("MAMO_PAY")
  externalId    String? // ID from payment provider
  paymentLinkId String? // ID of the payment link in our system
  metadata      Json? // Additional metadata about the payment
  completedAt   DateTime? // When the payment was completed
  refundedAt    DateTime? // When the payment was refunded (if applicable)
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  booking       Booking       @relation(fields: [bookingId], references: [id], onDelete: Cascade)

  @@map("payments")
}
