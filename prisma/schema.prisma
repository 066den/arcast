generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Studio {
  id          String    @id @default(cuid())
  name        String
  location    String    @default("Dubai")
  imageUrl    String?
  totalSeats  Int
  openingTime String
  closingTime String
  isActive    Boolean   @default(true)
  gallery     String[]  @default([])
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  bookings    Booking[]

  @@map("studios")
}

model ServiceType {
  id          String    @id @default(cuid())
  name        String    @unique
  description String?
  slug        String    @unique
  sortOrder   Int       @default(0)
  isActive    Boolean   @default(true)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  samples     Sample[]
  services    Service[]

  @@map("service_types")
}

model Service {
  id                    String                 @id @default(cuid())
  name                  String                 @unique
  description           String?
  includes              String[]               @default([])
  imageUrl              String?
  serviceTypeId         String
  isPopular             Boolean                @default(false)
  isActive              Boolean                @default(true)
  price                 Decimal                @db.Decimal(10, 2)
  currency              String                 @default("AED")
  sortOrder             Int                    @default(0)
  createdAt             DateTime               @default(now())
  updatedAt             DateTime               @updatedAt
  bookings              Booking[]
  servicePackageRecords ServicePackageRecord[]
  serviceType           ServiceType            @relation(fields: [serviceTypeId], references: [id])

  @@map("services")
}

model ServicePackageRecord {
  id                     String  @id @default(cuid())
  parentContentPackageId String
  includedServiceId      String
  serviceQuantity        Int
  includedService        Service @relation(fields: [includedServiceId], references: [id], onDelete: Cascade)
  package                Package @relation(fields: [parentContentPackageId], references: [id], onDelete: Cascade)

  @@unique([parentContentPackageId, includedServiceId])
  @@map("service_packages_records")
}

model AddServicePackageRecord {
  id                        String            @id @default(cuid())
  parentContentPackageId    String
  includedServiceId         String
  serviceQuantity           Int
  includedAdditionalService AdditionalService @relation(fields: [includedServiceId], references: [id], onDelete: Cascade)
  package                   Package           @relation(fields: [parentContentPackageId], references: [id], onDelete: Cascade)

  @@unique([parentContentPackageId, includedServiceId])
  @@map("add_service_packages_records")
}

model Package {
  id                       String                    @id @default(cuid())
  name                     String
  description              String?
  basePrice                Decimal                   @db.Decimal(10, 2)
  currency                 String                    @default("AED")
  isActive                 Boolean                   @default(true)
  createdAt                DateTime                  @default(now())
  updatedAt                DateTime                  @updatedAt
  addServicePackageRecords AddServicePackageRecord[]
  bookings                 Booking[]
  servicePackageRecords    ServicePackageRecord[]

  @@map("packages")
}

model DiscountCode {
  id                     String       @id @default(cuid())
  code                   String       @unique
  type                   DiscountType
  value                  Decimal      @db.Decimal(10, 2)
  currency               String       @default("AED")
  isActive               Boolean      @default(true)
  startDate              DateTime     @default(now())
  endDate                DateTime
  usageLimit             Int?
  usedCount              Int          @default(0)
  firstTimeOnly          Boolean      @default(false)
  minOrderAmount         Decimal?     @db.Decimal(10, 2)
  applicableContentTypes String[]
  createdAt              DateTime     @default(now())
  updatedAt              DateTime     @updatedAt
  bookings               Booking[]
  orders                 Order[]

  @@map("discount_codes")
}

model Booking {
  id                        String                     @id @default(cuid())
  startTime                 DateTime
  endTime                   DateTime
  numberOfSeats             Int
  totalCost                 Decimal                    @db.Decimal(10, 2)
  vatAmount                 Decimal?                   @db.Decimal(10, 2)
  discountAmount            Decimal?                   @db.Decimal(10, 2)
  finalAmount               Decimal?                   @db.Decimal(10, 2)
  status                    BookingStatus              @default(PENDING)
  createdAt                 DateTime                   @default(now())
  updatedAt                 DateTime                   @updatedAt
  studioId                  String?
  contentPackageId          String?
  serviceId                 String?
  leadId                    String
  discountCodeId            String?
  bookingAdditionalServices BookingAdditionalService[]
  contentPackage            Package?                   @relation(fields: [contentPackageId], references: [id])
  discountCode              DiscountCode?              @relation(fields: [discountCodeId], references: [id])
  lead                      Lead                       @relation(fields: [leadId], references: [id])
  service                   Service?                   @relation(fields: [serviceId], references: [id])
  studio                    Studio?                    @relation(fields: [studioId], references: [id])
  payment                   Payment?

  @@map("bookings")
}

model Lead {
  id                String    @id @default(cuid())
  fullName          String
  email             String?
  phoneNumber       String?
  whatsappNumber    String?
  recordingLocation String?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  bookings          Booking[]
  orders            Order[]

  @@map("leads")
}

model AdditionalService {
  id                        String                     @id @default(cuid())
  name                      String
  type                      AdditionalServiceType      @default(STANDARD)
  price                     Decimal                    @db.Decimal(10, 2)
  currency                  String                     @default("AED")
  count                     Int                        @default(1)
  description               String?
  imageUrls                 String[]
  isActive                  Boolean                    @default(true)
  createdAt                 DateTime                   @default(now())
  updatedAt                 DateTime                   @updatedAt
  addServicePackageRecords  AddServicePackageRecord[]
  bookingAdditionalServices BookingAdditionalService[]

  @@map("additional_services")
}

model BookingAdditionalService {
  id         String            @id @default(cuid())
  bookingId  String
  serviceId  String
  quantity   Int               @default(1)
  unitPrice  Decimal           @db.Decimal(10, 2)
  totalPrice Decimal           @db.Decimal(10, 2)
  createdAt  DateTime?
  updatedAt  DateTime?
  booking    Booking           @relation(fields: [bookingId], references: [id], onDelete: Cascade)
  service    AdditionalService @relation(fields: [serviceId], references: [id])

  @@unique([bookingId, serviceId])
  @@map("booking_additional_services")
}

model Payment {
  id            String        @id @default(cuid())
  bookingId     String        @unique
  amount        Decimal       @db.Decimal(10, 2)
  currency      String        @default("AED")
  status        PaymentStatus @default(PENDING)
  provider      String        @default("MAMO_PAY")
  externalId    String?
  paymentLinkId String?
  metadata      Json?
  completedAt   DateTime?
  refundedAt    DateTime?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  booking       Booking       @relation(fields: [bookingId], references: [id], onDelete: Cascade)

  @@map("payments")
}

model CaseStudy {
  id          String             @id @default(cuid())
  clientId    String?
  title       String?
  tagline     String?
  mainText    String?
  isActive    Boolean            @default(true)
  imageUrls   String[]
  client      Client?            @relation(fields: [clientId], references: [id])
  caseContent CaseStudyContent[]
  equipment   Equipment[]        @relation("CaseStudyToEquipment")
  staff       Staff[]            @relation("CaseStudyToStaff")

  @@map("case_studies")
}

model CaseStudyContent {
  id          String    @id @default(cuid())
  caseStudyId String
  title       String
  text        String[]
  list        String[]
  imageUrl    String
  order       Int
  caseStudy   CaseStudy @relation(fields: [caseStudyId], references: [id], onDelete: Cascade)

  @@map("case_study_content")
}

model Equipment {
  id          String      @id @default(cuid())
  name        String?
  description String?
  imageUrl    String?
  caseStudies CaseStudy[] @relation("CaseStudyToEquipment")

  @@map("equipment")
}

model Staff {
  id          String      @id @default(cuid())
  name        String?
  role        String?
  imageUrl    String?
  caseStudies CaseStudy[] @relation("CaseStudyToStaff")

  @@map("staff")
}

model Client {
  id          String      @id @default(cuid())
  name        String?
  showTitle   String?
  jobTitle    String?
  testimonial String?
  featured    Boolean     @default(false)
  imageUrl    String?
  caseStudies CaseStudy[]

  @@map("clients")
}

model Sample {
  id            String       @id @default(cuid())
  name          String?
  thumbUrl      String?
  videoUrl      String?
  serviceTypeId String?
  serviceType   ServiceType? @relation(fields: [serviceTypeId], references: [id])

  @@map("samples")
}

model BlogRecord {
  id           String   @id @default(cuid())
  title        String
  tagline      String
  mainText     String
  mainImageUrl String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@map("blog_records")
}

model Order {
  id             String        @id @default(cuid())
  serviceName    String
  description    String?
  requirements   String?
  totalCost      Decimal       @db.Decimal(10, 2)
  vatAmount      Decimal?      @db.Decimal(10, 2)
  discountAmount Decimal?      @db.Decimal(10, 2)
  finalAmount    Decimal?      @db.Decimal(10, 2)
  status         OrderStatus   @default(PENDING)
  estimatedDays  Int?
  deadline       DateTime?
  completedAt    DateTime?
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  leadId         String
  discountCodeId String?
  payment        OrderPayment?
  discountCode   DiscountCode? @relation(fields: [discountCodeId], references: [id])
  lead           Lead          @relation(fields: [leadId], references: [id])

  @@map("orders")
}

model OrderPayment {
  id            String        @id @default(cuid())
  orderId       String        @unique
  amount        Decimal       @db.Decimal(10, 2)
  currency      String        @default("AED")
  status        PaymentStatus @default(PENDING)
  provider      String        @default("MAMO_PAY")
  externalId    String?
  paymentLinkId String?
  metadata      Json?
  completedAt   DateTime?
  refundedAt    DateTime?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  order         Order         @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@map("order_payments")
}

model CallRequest {
  id           String   @id @default(cuid())
  firstName    String
  lastName     String?
  phone        String
  callDateTime DateTime
  message      String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@map("call_requests")
}

model Admin {
  id           String    @id @default(cuid())
  username     String    @unique
  passwordHash String
  email        String?
  role         String    @default("admin")
  isActive     Boolean   @default(true)
  lastLoginAt  DateTime?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt

  @@map("admins")
}

enum DiscountType {
  PERCENTAGE
  FIXED_AMOUNT
}

enum BookingStatus {
  PENDING
  CONFIRMED
  CANCELLED
  COMPLETED
}

enum AdditionalServiceType {
  STANDARD
  BY_THREE
}

enum PaymentStatus {
  PENDING
  COMPLETED
  FAILED
  REFUNDED
}

enum OrderStatus {
  PENDING
  CONFIRMED
  IN_PROGRESS
  COMPLETED
  CANCELLED
}
